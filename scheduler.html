<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Pl√°novaƒç & Linky</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f4f7f6; text-align: center; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        h2 { color: #244b94; margin-top: 0; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        
        /* FORM STYLES */
        .form-row { display: flex; gap: 10px; margin-bottom: 15px; }
        label { display: block; margin: 5px 0 5px; font-weight: bold; text-align: left; }
        select, input { width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc; font-size: 16px; box-sizing: border-box; }
        
        /* CREATE BUTTON */
        .btn-create { margin-top: 15px; width: 100%; padding: 12px; background: #244b94; color: white; border: none; border-radius: 5px; font-size: 18px; font-weight: bold; cursor: pointer; }
        .btn-create:hover { background: #1a3a7a; }

        /* LIST STYLES */
        .match-list { margin-top: 30px; text-align: left; }
        .match-card { 
            background: #fff; border: 1px solid #ddd; padding: 15px; margin-bottom: 10px; border-radius: 8px; 
            display: flex; flex-direction: column; gap: 10px;
        }
        .match-header { font-weight: bold; color: #333; display: flex; justify-content: space-between; }
        .match-teams { font-size: 1.1em; color: #244b94; }

        .link-row { display: flex; gap: 10px; align-items: center; background: #f9f9f9; padding: 8px; border-radius: 5px; }
        .link-input { padding: 5px; font-size: 0.9em; flex-grow: 1; border: 1px solid #ccc; }
        
        .btn-save { background: #28a745; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .btn-del { background: #d90f23; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-weight: bold; margin-left: auto; }
        
        .msg { color: green; font-weight: bold; display: none; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="container">
        <h2>üìÖ Vytvori≈• Nov√Ω Z√°pas</h2>
        
        <div class="form-row">
            <div style="flex:1">
                <label>D√°tum:</label>
                <input type="date" id="matchDate">
            </div>
            <div style="flex:1">
                <label>ƒåas:</label>
                <input type="time" id="matchTime">
            </div>
        </div>

        <div class="form-row">
            <div style="flex:1">
                <label>Dom√°ci:</label>
                <select id="homeTeam"></select>
            </div>
            <div style="flex:1">
                <label>Hostia:</label>
                <select id="awayTeam"></select>
            </div>
        </div>

        <button class="btn-create" onclick="createMatch()">+ Prida≈• do Kalend√°ra</button>
        <div id="msg" class="msg">Z√°pas √∫spe≈°ne vytvoren√Ω!</div>

        <h2 style="margin-top: 40px;">üìã Spr√°va Z√°pasov & Linkov</h2>
        <div id="matchesList" class="match-list">Naƒç√≠tavam...</div>
    </div>

    <script>
        const API_BASE = "https://Lucifer21sk.pythonanywhere.com";

        // 1. Load Teams on Startup
        async function loadTeams() {
            try {
                const response = await fetch(`${API_BASE}/teams`);
                const teams = await response.json();
                
                const homeSelect = document.getElementById("homeTeam");
                const awaySelect = document.getElementById("awayTeam");

                teams.forEach(t => {
                    homeSelect.innerHTML += `<option value="${t.id}">${t.name}</option>`;
                    awaySelect.innerHTML += `<option value="${t.id}">${t.name}</option>`;
                });
                
                loadScheduledMatches();
            } catch (err) { console.error(err); }
        }

        // 2. Load Existing Matches
        async function loadScheduledMatches() {
            try {
                const response = await fetch(`${API_BASE}/matches`);
                const matches = await response.json();
                const container = document.getElementById("matchesList");
                
                const upcoming = matches.filter(m => !m.is_finished);

                container.innerHTML = "";
                if (upcoming.length === 0) {
                    container.innerHTML = "<p>≈Ωiadne napl√°novan√© z√°pasy.</p>";
                    return;
                }

                upcoming.forEach(m => {
                    const existingLink = m.livestream_url ? m.livestream_url : "";
                    
                    container.innerHTML += `
                        <div class="match-card">
                            <div class="match-header">
                                <span>üìÖ ${m.date} | üïí ${m.time}</span>
                            </div>
                            <div class="match-teams">${m.home_team} vs ${m.away_team}</div>
                            
                            <div class="link-row">
                                <span>üì∫</span>
                                <input type="text" id="link-${m.id}" class="link-input" value="${existingLink}" placeholder="Sem vlo≈æte YouTube link...">
                                <button class="btn-save" onclick="saveLink(${m.id})">Ulo≈æi≈• Link</button>
                            </div>

                            <div style="text-align:right; margin-top:5px;">
                                <button class="btn-del" onclick="deleteMatch(${m.id})">üóëÔ∏è Zmaza≈• Z√°pas</button>
                            </div>
                        </div>
                    `;
                });
            } catch (err) { console.error(err); }
        }

        // 3. Create New Match (LOCATION REMOVED)
        async function createMatch() {
            const homeId = document.getElementById("homeTeam").value;
            const awayId = document.getElementById("awayTeam").value;
            const dateVal = document.getElementById("matchDate").value;
            const timeVal = document.getElementById("matchTime").value;

            if (homeId === awayId) { alert("Dom√°ci a Hostia nem√¥≈æu by≈• ten ist√Ω t√≠m!"); return; }
            if (!dateVal || !timeVal) { alert("Vyberte d√°tum a ƒças!"); return; }

            const response = await fetch(`${API_BASE}/matches`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    home_team_id: homeId,
                    away_team_id: awayId,
                    date: dateVal,
                    time: timeVal,
                    livestream_url: "" 
                    // NO LOCATION HERE
                })
            });

            if (response.ok) {
                document.getElementById("msg").style.display = "block";
                setTimeout(() => document.getElementById("msg").style.display = "none", 3000);
                loadScheduledMatches();
            } else {
                alert("Chyba pri ukladan√≠.");
            }
        }

        // 4. Save YouTube Link
        async function saveLink(matchId) {
            const linkVal = document.getElementById(`link-${matchId}`).value;
            const response = await fetch(`${API_BASE}/matches/update_link`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ match_id: matchId, livestream_url: linkVal })
            });

            if (response.ok) {
                alert("‚úÖ Link ulo≈æen√Ω! Tlaƒçidlo sa zobraz√≠ na str√°nke.");
            } else {
                alert("‚ùå Chyba pri ukladan√≠ linku.");
            }
        }

        // 5. Delete Match
        async function deleteMatch(id) {
            if (!confirm("Naozaj chcete odstr√°ni≈• tento z√°pas? Toto sa ned√° vr√°ti≈•.")) return;
            const response = await fetch(`${API_BASE}/matches/${id}/delete`, { method: "DELETE" });
            if (response.ok) {
                loadScheduledMatches();
            } else {
                alert("Chyba pri mazan√≠.");
            }
        }

        loadTeams();
    </script>
</body>
</html>