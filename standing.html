<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SAILH - Tabuƒæky & ≈†tatistiky</title>
    <link rel="stylesheet" href="styles.css" />
    <style>
        .container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }

        .section-title {
            color: #244b94;
            border-bottom: 3px solid #d90f23;
            display: inline-block;
            padding-bottom: 5px;
            margin-bottom: 20px;
            font-size: 1.4em;
            text-transform: uppercase;
            font-weight: 800;
        }

        /* SCROLLABLE BOX STYLE */
        .scroll-window {
            max-height: 450px;
            overflow-y: auto;
            border: 1px solid #ddd;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        /* CUSTOM SCROLLBAR */
        .scroll-window::-webkit-scrollbar { width: 8px; }
        .scroll-window::-webkit-scrollbar-track { background: #f1f1f1; }
        .scroll-window::-webkit-scrollbar-thumb { background: #ccc; border-radius: 4px; }
        .scroll-window::-webkit-scrollbar-thumb:hover { background: #aaa; }

        /* TABLES */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th, .data-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #eee;
            font-size: 0.95em;
        }

        /* STICKY HEADER */
        .data-table thead th {
            position: sticky;
            top: 0;
            background: #244b94;
            color: white;
            z-index: 2;
            box-shadow: 0 2px 2px rgba(0,0,0,0.1);
        }

        /* TOOLTIP STYLES */
        th[title], .tooltip-span {
            cursor: help;
            text-decoration: underline dotted rgba(0, 0, 0, 0.4);
        }
        th[title] {
            text-decoration: underline dotted rgba(255, 255, 255, 0.5);
        }

        .data-table tr:hover { background-color: #f9f9f9; }
        
        .rank-col { font-weight: bold; color: #d90f23; width: 40px; }
        .name-col { text-align: left; font-weight: 600; }
        .points-col { font-weight: bold; background: #f4f8ff; color: #244b94; }

        /* GRID LAYOUT */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 40px;
        }

        @media (max-width: 900px) {
            .stats-grid { grid-template-columns: 1fr; }
        }

        /* HISTORY ITEMS - NEW 3-COLUMN LAYOUT */
        .history-item {
            display: flex;
            align-items: center; /* Vertically center everything */
            padding: 12px 20px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.2s;
        }
        .history-item:hover { background: #f0f4ff; }
        
        /* 1. Date on the LEFT (Fixed width ensures alignment) */
        .h-date { 
            width: 100px; 
            text-align: left; 
            font-size: 0.85em; 
            color: #888; 
            flex-shrink: 0; /* Prevents squishing */
        }

        /* 2. Match Info in the CENTER (Takes all remaining space) */
        .h-match-info {
            flex: 1;
            text-align: center;
        }

        /* 3. Button on the RIGHT */
        .h-btn {
            width: 80px;
            text-align: right;
            font-size: 0.8em;
            color: #244b94;
            font-weight: bold;
        }

        .h-score { font-weight: bold; color: #d90f23; font-size: 1.1em; margin: 0 15px; }
        
        /* MODAL */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(3px); }
        .modal-content { background: white; margin: 10% auto; padding: 25px; border-radius: 12px; width: 90%; max-width: 500px; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        .close-btn { float: right; font-size: 28px; cursor: pointer; color: #aaa; }
        .close-btn:hover { color: #d90f23; }
    </style>
</head>
<body>

    <header class="header">
        <div class="logo">
            <img src="logo.png" alt="SAILH Logo" class="logo-img">
        </div>
        <div class="site-title">Slovensk√° asoci√°cia in-line hokeja</div>
        <nav class="menu">
            <a href="index.html">Domov</a>
            <a href="standing.html" class="active">Extraliga</a>
            <a href="https://www.inlineliga.sk">Amat√©rska liga</a>
            <a href="clubs.html">Kluby</a>
            <a href="https://www.mihwa.org/">MIHWA</a>
            <a href="gallery.html">Gal√©ria</a>
            <a href="partners.html">Partneri</a>
        </nav>
    </header>

    <div class="container">

        <h2 class="section-title">Z√°pasov√° Hist√≥ria</h2>
        <div class="scroll-window" id="historyList">
            <p style="padding:15px; text-align:center;">Naƒç√≠tavam hist√≥riu...</p>
        </div>

        <div class="stats-grid">
            
            <div>
                <h2 class="section-title">Tabuƒæka T√≠mov</h2>
                <div style="overflow-x: auto; border:1px solid #ddd; border-radius:8px;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th class="name-col">T√≠m</th>
                                <th title="Poƒçet odohran√Ωch z√°pasov">Z</th>
                                <th title="V√Ωhry (3 body)">V</th>
                                <th title="V√Ωhry po predƒ∫≈æen√≠/n√°jazdoch (2 body)">Vp</th>
                                <th title="Prehry po predƒ∫≈æen√≠/n√°jazdoch (1 bod)">Pp</th>
                                <th title="Prehry (0 bodov)">P</th>
                                <th title="Body" class="points-col">B</th>
                            </tr>
                        </thead>
                        <tbody id="teamTable">
                            <tr><td colspan="8">Naƒç√≠tavam...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div>
                <h2 class="section-title">Hr√°ƒçske ≈†tatistiky</h2>
                <div class="scroll-window">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th class="name-col">Meno</th>
                                <th title="Poƒçet odohran√Ωch z√°pasov">Z</th>
                                <th title="G√≥ly">G</th>
                                <th title="Asistencie">A</th>
                                <th title="Kanadsk√© body (G√≥ly + Asistencie)" class="points-col">B</th>
                            </tr>
                        </thead>
                        <tbody id="playerTable">
                            <tr><td colspan="6">Naƒç√≠tavam...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

        </div>

    </div>

    <div id="detailsModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle" style="color:#244b94; margin-top:0; border-bottom:2px solid #ddd; padding-bottom:10px;">Detaily</h2>
            <div id="modalBody" style="max-height:400px; overflow-y:auto;"></div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-container">
            <div class="footer-col">
                <h4 class="footer-title">SAILH</h4>
                <div class="footer-line"></div>
                <p class="footer-text">
                    Slovensk√° asoci√°cia in-line hokeja.<br>
                    Oreganov√° 1178/1<br>
                    900 46 Most pri Bratislave
                </p>
            </div>
            <div class="footer-col">
                <h4 class="footer-title">R√Ωchle Odkazy</h4>
                <div class="footer-line"></div>
                <ul class="footer-links">
                    <li><a href="index.html">Domov</a></li>
                    <li><a href="standing.html">Extraliga</a></li>
                    <li><a href="clubs.html">Kluby</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h4 class="footer-title">Kontakt</h4>
                <div class="footer-line"></div>
                <div class="contact-item">üìß <a href="mailto:pejchalr@gmail.com">pejchalr@gmail.com</a></div>
            </div>
        </div>
        <div class="footer-bottom">¬© 2026 SAILH</div>
    </footer>

    <script>
        const API_BASE = "https://Lucifer21sk.pythonanywhere.com";

        // 1. Load Teams
        async function loadTeams() {
            try {
                const res = await fetch(`${API_BASE}/stats/teams`);
                const data = await res.json();
                const tbody = document.getElementById("teamTable");
                tbody.innerHTML = "";
                data.forEach((t, i) => {
                    tbody.innerHTML += `
                        <tr>
                            <td class="rank-col">${i + 1}.</td>
                            <td class="name-col">${t.name}</td>
                            <td>${t.gp}</td>
                            <td>${t.w}</td>
                            <td>${t.ow}</td>
                            <td>${t.ol}</td>
                            <td>${t.l}</td>
                            <td class="points-col">${t.pts}</td>
                        </tr>`;
                });
            } catch (e) { console.error(e); }
        }

        // 2. Load Players
        async function loadPlayers() {
            try {
                const res = await fetch(`${API_BASE}/stats/players`);
                const data = await res.json();
                const tbody = document.getElementById("playerTable");
                tbody.innerHTML = "";
                
                data.forEach((p, i) => { 
                    let rank = `${i + 1}.`;
                    if (i === 0) rank = "ü•á";
                    if (i === 1) rank = "ü•à";
                    if (i === 2) rank = "ü•â";

                    tbody.innerHTML += `
                        <tr>
                            <td class="rank-col">${rank}</td>
                            <td class="name-col">${p.name}</td>
                            <td>${p.gp}</td>
                            <td>${p.g}</td>
                            <td>${p.a}</td>
                            <td class="points-col">${p.pts}</td>
                        </tr>`;
                });
            } catch (e) { console.error(e); }
        }

        // 3. Load History (NEW LAYOUT)
        async function loadHistory() {
            try {
                const res = await fetch(`${API_BASE}/matches/history`);
                const data = await res.json();
                const list = document.getElementById("historyList");
                list.innerHTML = "";
                
                if(data.length === 0) {
                    list.innerHTML = "<p style='padding:15px; text-align:center;'>Zatiaƒæ ≈æiadne odohran√© z√°pasy.</p>";
                    return;
                }

                data.forEach(m => {
                    let phaseLabel = "";
                    if (m.phase === 'overtime') {
                        phaseLabel = ' <span class="tooltip-span" title="Po predƒ∫≈æen√≠">(PP)</span>';
                    }
                    if (m.phase === 'shootout') {
                        phaseLabel = ' <span class="tooltip-span" title="Po samostatn√Ωch n√°jazdoch">(SN)</span>';
                    }

                    list.innerHTML += `
                        <div class="history-item" onclick="openMatchDetails(${m.id}, '${m.home_team} vs ${m.away_team}')">
                            <div class="h-date">${m.date}</div>
                            
                            <div class="h-match-info">
                                <span style="font-weight:600">${m.home_team}</span>
                                <span class="h-score">${m.home_score} : ${m.away_score}${phaseLabel}</span>
                                <span style="font-weight:600">${m.away_team}</span>
                            </div>

                            <div class="h-btn">Detaily ‚ûù</div>
                        </div>
                    `;
                });
            } catch (e) { console.error(e); }
        }

        // 4. Modal
        async function openMatchDetails(matchId, titleText) {
            const modal = document.getElementById("detailsModal");
            const body = document.getElementById("modalBody");
            document.getElementById("modalTitle").innerText = titleText;
            
            modal.style.display = "block";
            body.innerHTML = "Naƒç√≠tavam...";

            try {
                const res = await fetch(`${API_BASE}/matches/${matchId}/details`);
                const events = await res.json();
                
                if (events.length === 0) {
                    body.innerHTML = "<p>≈Ωiadne g√≥ly v tomto z√°pase.</p>";
                    return;
                }

                let html = `<table class="data-table" style="font-size:0.9em;">
                            <thead><tr><th>Sk√≥re</th><th>T√≠m</th><th>Strelec</th><th>Asistencie</th></tr></thead><tbody>`;
                
                events.forEach(e => {
                    let assists = "";
                    if (e.a1) assists += e.a1;
                    if (e.a2) assists += ", " + e.a2;
                    
                    html += `<tr>
                        <td style="font-weight:bold; color:#d90f23;">${e.score}</td>
                        <td>${e.team}</td>
                        <td style="font-weight:bold;">${e.scorer}</td>
                        <td style="color:#666;">${assists}</td>
                    </tr>`;
                });
                html += "</tbody></table>";
                body.innerHTML = html;
            } catch (e) { body.innerHTML = "Chyba."; }
        }

        function closeModal() { document.getElementById("detailsModal").style.display = "none"; }
        window.onclick = function(e) { if(e.target == document.getElementById("detailsModal")) closeModal(); }

        loadTeams();
        loadPlayers();
        loadHistory();
    </script>
</body>
</html>